# @package _global_

name: deep_svdd

defaults:
  - /pipeline/anomaly/deep_svdd@pipeline: deep_svdd
  - /data@data: lentils
  - /training@training: default
  - _self_

data:
  train_ids: [0]
  val_ids: [3, 4, 6]
  test_ids: [1, 5]

training:
  seed: 42
  trainer:
    max_epochs: 20
    accelerator: auto
    devices: 1
    default_root_dir: ./outputs/deepsvdd
    precision: 32-true
    accumulate_grad_batches: 1
    enable_progress_bar: true
    enable_checkpointing: true
    log_every_n_steps: 10
    val_check_interval: 1.0
    check_val_every_n_epoch: 1
    gradient_clip_val: 1.0
    deterministic: false
    benchmark: false
    callbacks:
      checkpoint:
        dirpath: outputs\deepsvdd\checkpoints
        monitor: metrics_anomaly/iou
        filename: "{epoch:02d}"
        mode: max
        save_top_k: 3
        save_last: true
        verbose: true
        auto_insert_metric_name: true
      learning_rate_monitor:
        logging_interval: epoch
        log_momentum: false
  optimizer:
    name: adamw
    lr: 0.001
    weight_decay: 0.01
    betas: [0.9, 0.999]
  scheduler:
    name: reduce_on_plateau
    monitor: metrics_anomaly/iou
    mode: max
    factor: 0.5
    patience: 5
    threshold: 0.0001
    threshold_mode: rel
    cooldown: 0
    min_lr: 1.0e-06
    eps: 1.0e-08
    verbose: false
output_dir: outputs\deepsvdd
unfreeze_nodes:
  - ZScoreNormalizerGlobal
freeze_nodes: []
metric_nodes:
  - metrics_anomaly
loss_nodes:
  - deepsvdd_loss

# Node & preprocessing parameters
# pipeline:
#   bandpass:
#     min_wavelength_nm: 700.0
#     max_wavelength_nm: null

#   encoder:
#     num_channels: 27
#     hidden: 128

#   projection:
#     in_channels: 27
#     rep_dim: 32
#     hidden: 128

#   center_tracker:
#     rep_dim: 32
#     alpha: 0.1

#   loss:
#     nu: 0.05

#   decider:
#     quantile: 0.995

#   viz:
#     mask_channel: 30
#     up_to: 5
