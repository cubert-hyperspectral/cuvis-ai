name: ''
nodes:
- name: LentilsAnomalyDataNode
  class_name: cuvis_ai.node.data.LentilsAnomalyDataNode
  hparams:
    normal_class_ids:
    - 0
    - 1
    anomaly_class_ids:
    - 3
- name: MinMaxNormalizer
  class_name: cuvis_ai.node.normalization.MinMaxNormalizer
  hparams:
    eps: 1.0e-06
    use_running_stats: true
- name: concrete_selector
  class_name: cuvis_ai.node.channel_mixer.ConcreteChannelMixer
  hparams:
    input_channels: 61
    output_channels: 3
    tau_start: 10.0
    tau_end: 0.1
    max_epochs: 20
    use_hard_inference: true
    eps: 1.0e-06
- name: adaclip
  class_name: cuvis_ai_adaclip.node.adaclip_node.AdaCLIPDetector
  hparams:
    weight_name: pretrained_all
    backbone: ViT-L-14-336
    prompt_text: ''
    image_size: 518
    prompting_depth: 4
    prompting_length: 5
    gaussian_sigma: 4.0
    use_half_precision: false
    enable_warmup: false
    enable_gradients: true
    use_torch_preprocess: true
- name: iou_loss
  class_name: cuvis_ai.node.losses.IoULoss
  hparams:
    weight: 1.0
    smooth: 1.0e-06
    normalize_method: minmax
- name: distinctness_loss
  class_name: cuvis_ai.node.losses.DistinctnessLoss
  hparams:
    weight: 0.1
    eps: 1.0e-06
- name: decider
  class_name: cuvis_ai.deciders.two_stage_decider.TwoStageBinaryDecider
  hparams:
    image_threshold: 0.24 # 0.15 with cuvis next works
    top_k_fraction: 0.001
    quantile: 0.995
    reduce_dims: null
- name: metrics_anomaly
  class_name: cuvis_ai.node.metrics.AnomalyDetectionMetrics
  hparams:
    execution_stages: null
- name: score_heatmap
  class_name: cuvis_ai.node.anomaly_visualization.ScoreHeatmapVisualizer
  hparams:
    normalize_scores: true
    cmap: inferno
    up_to: 5
- name: mask
  class_name: cuvis_ai.node.anomaly_visualization.AnomalyMask
  hparams:
    channel: 30
    up_to: 5
- name: concrete_tensorboard_viz
  class_name: cuvis_ai.node.pipeline_visualization.PipelineComparisonVisualizer
  hparams:
    hsi_channels:
    - 0
    - 20
    - 40
    max_samples: 4
    log_every_n_batches: 1
- name: TensorBoardMonitorNode
  class_name: cuvis_ai.node.monitor.TensorBoardMonitorNode
  hparams:
    output_dir: outputs\concrete_adaclip\tensorboard
    run_name: Concrete_AdaClip_Gradient
    comment: ''
    flush_secs: 120
connections:
- source: LentilsAnomalyDataNode.outputs.cube
  target: MinMaxNormalizer.inputs.data
- source: LentilsAnomalyDataNode.outputs.mask
  target: iou_loss.inputs.targets
- source: LentilsAnomalyDataNode.outputs.mask
  target: metrics_anomaly.inputs.targets
- source: LentilsAnomalyDataNode.outputs.mask
  target: mask.inputs.mask
- source: LentilsAnomalyDataNode.outputs.cube
  target: mask.inputs.cube
- source: LentilsAnomalyDataNode.outputs.cube
  target: concrete_tensorboard_viz.inputs.hsi_cube
- source: LentilsAnomalyDataNode.outputs.mask
  target: concrete_tensorboard_viz.inputs.ground_truth_mask
- source: MinMaxNormalizer.outputs.normalized
  target: concrete_selector.inputs.data
- source: concrete_selector.outputs.rgb
  target: adaclip.inputs.rgb_image
- source: concrete_selector.outputs.selection_weights
  target: distinctness_loss.inputs.selection_weights
- source: concrete_selector.outputs.rgb
  target: concrete_tensorboard_viz.inputs.mixer_output
- source: adaclip.outputs.scores
  target: iou_loss.inputs.predictions
- source: adaclip.outputs.scores
  target: decider.inputs.logits
- source: adaclip.outputs.scores
  target: metrics_anomaly.inputs.logits
- source: adaclip.outputs.scores
  target: score_heatmap.inputs.scores
- source: adaclip.outputs.scores
  target: mask.inputs.scores
- source: adaclip.outputs.scores
  target: concrete_tensorboard_viz.inputs.adaclip_scores
- source: decider.outputs.decisions
  target: metrics_anomaly.inputs.decisions
- source: decider.outputs.decisions
  target: mask.inputs.decisions
- source: metrics_anomaly.outputs.metrics
  target: TensorBoardMonitorNode.inputs.metrics
- source: score_heatmap.outputs.artifacts
  target: TensorBoardMonitorNode.inputs.artifacts
- source: mask.outputs.artifacts
  target: TensorBoardMonitorNode.inputs.artifacts
- source: concrete_tensorboard_viz.outputs.artifacts
  target: TensorBoardMonitorNode.inputs.artifacts
metadata:
  name: Concrete_AdaClip_Gradient
  description: 'Trained Concrete band selector + AdaClip model from Concrete_AdaClip_Gradient
    trainrun. Selector reduces 61 channels to 3 for AdaClip compatibility. Selected
    bands: [55, 56, 24]. Updated with TwoStageBinaryDecider (image_threshold=0.24, quantile=0.995)'
  created: ''
  tags:
  - gradient
  - concrete
  - gumbel
  - adaclip
  - band_selector
  - anomaly_detection
  author: cuvis.ai
  cuvis_ai_version: 0.1.5.post40+g5d4ea80af.d20260105
